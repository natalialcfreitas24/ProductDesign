{
    "name": "Consultar Agenda do Dia",
    "nodes": [
        {
            "parameters": {
                "updates": {
                    "chatMessage": true
                }
            },
            "name": "Telegram Trigger",
            "type": "n8n-nodes-base.telegramTrigger",
            "typeVersion": 1,
            "position": [
                250,
                300
            ]
        },
        {
            "parameters": {
                "chatCompletion": {
                    "model": "gpt-3.5-turbo",
                    "messages": [
                        {
                            "role": "system",
                            "content": "Voc\u00ea \u00e9 um assistente que ajuda a Nat\u00e1lia a consultar os eventos no Google Calendar.\nHoje \u00e9 {{ $now.format('YYYY-MM-DD') }}.\n\nQuando ela disser algo como:\n- '/agenda hoje'\n- '/agenda amanh\u00e3'\n- '/agenda dia 15'\n- '/agenda pr\u00f3ximo s\u00e1bado'\n\nretorne JSON exatamente assim, com as datas j\u00e1 resolvidas para o per\u00edodo do dia, e inclua location se houver:\n{\n  \"summary\": \"Agenda do dia\",\n  \"start\": \"2025-07-23T00:00:00-03:00\",\n  \"end\": \"2025-07-23T23:59:59-03:00\",\n  \"location\": \"\"\n}\nN\u00e3o explique nada, apenas retorne o JSON puro."
                        },
                        {
                            "role": "user",
                            "content": "{{$json[\"message\"][\"text\"]}}"
                        }
                    ]
                }
            },
            "name": "AI Agent",
            "type": "n8n-nodes-base.openAiChat",
            "typeVersion": 1,
            "position": [
                450,
                300
            ]
        },
        {
            "parameters": {
                "calendar": "primary",
                "returnAll": true,
                "options": {
                    "after": "={{ $json[\"start\"] }}",
                    "before": "={{ $json[\"end\"] }}"
                }
            },
            "name": "Get Event from Google Calendar",
            "type": "n8n-nodes-base.googleCalendar",
            "typeVersion": 1,
            "position": [
                650,
                300
            ],
            "credentials": {
                "googleApi": "Google Calendar account"
            }
        },
        {
            "parameters": {
                "functionCode": "const eventos = items;\nlet texto = \"\ud83d\uddd3 *Agenda do dia:*\\n\";\nif (eventos.length === 0) {\n  texto += \"_Nenhum evento encontrado para este dia._\";\n} else {\n  for (const item of eventos) {\n    const summary = item.json.summary || \"Evento sem nome\";\n    const start = new Date(item.json.start.dateTime || item.json.start).toLocaleTimeString(\"pt-BR\", {\n      hour: \"2-digit\",\n      minute: \"2-digit\"\n    });\n    texto += `- ${start} ${summary}\\n`;\n  }\n}\nreturn [{\n  json: {\n    mensagem: texto,\n    chatId: $json[\"message\"][\"chat\"][\"id\"]\n  }\n}];"
            },
            "name": "Format Agenda Message",
            "type": "n8n-nodes-base.function",
            "typeVersion": 1,
            "position": [
                850,
                300
            ]
        },
        {
            "parameters": {
                "chatId": "={{ $json[\"chatId\"] }}",
                "text": "={{ $json[\"mensagem\"] }}"
            },
            "name": "Send a text message",
            "type": "n8n-nodes-base.telegram",
            "typeVersion": 1,
            "position": [
                1050,
                300
            ]
        }
    ],
    "connections": {
        "Telegram Trigger": {
            "main": [
                [
                    "AI Agent"
                ]
            ]
        },
        "AI Agent": {
            "main": [
                [
                    "Get Event from Google Calendar"
                ]
            ]
        },
        "Get Event from Google Calendar": {
            "main": [
                [
                    "Format Agenda Message"
                ]
            ]
        },
        "Format Agenda Message": {
            "main": [
                [
                    "Send a text message"
                ]
            ]
        }
    }
}